<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANFA G√ºvenlik</title>
<link rel="manifest" href="manifest.json">
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>
body{
margin:0;
font-family:Segoe UI;
background:url("https://source.unsplash.com/1600x900/?security,night,city") no-repeat center fixed;
background-size:cover;
color:white;
}
header{
background:rgba(0,0,0,0.8);
padding:15px;
display:flex;
justify-content:space-between;
box-shadow:0 0 20px cyan;
}
#logo{
font-size:28px;
color:cyan;
text-shadow:0 0 15px cyan;
}
.card{
background:rgba(0,0,0,0.7);
margin:15px;
padding:15px;
border-radius:15px;
box-shadow:0 0 15px cyan;
}
.task{
border:1px solid cyan;
padding:10px;
margin:5px;
border-radius:10px;
cursor:pointer;
}
.task.selected{background:rgba(0,255,255,0.4);}
.task.yapildi{background:rgba(255,0,0,0.4);}
button{padding:10px;border-radius:8px;border:none;background:cyan;font-weight:bold;}
input,textarea{width:100%;padding:10px;border-radius:8px;margin:5px;}
</style>
</head>

<body>

<header>
<div id="logo">ANFA G√úVENLƒ∞K</div>
<div id="clock"></div>
</header>

<div class="card" id="login">
<button onclick="login()">Gmail ile Giri≈ü</button>
</div>

<div class="card" id="app" style="display:none">

<h3>G√∂rev Panosu</h3>
<div id="gorevListe"></div>

<div>
<button onclick="toggleNew()">‚ûï Yeni G√∂rev</button>
<button onclick="doneTask()">‚úîÔ∏è</button>
<button onclick="deleteTask()">üóëÔ∏è</button>
</div>

<div id="newTask" style="display:none">
<input id="baslik" placeholder="Ba≈ülƒ±k">
<input id="aciklama" placeholder="A√ßƒ±klama">
<input type="datetime-local" id="alarm">
<button onclick="addTask()">Kaydet</button>
</div>

<hr>
<h3>Mesajlar</h3>
<div id="mesajListe"></div>
<input id="msg">
<button onclick="sendMsg()">G√∂nder</button>

<hr>
<h3>G√∂r√º≈ü & √ñneri</h3>
<textarea id="fb"></textarea>
<button onclick="sendFeedback()">G√∂nder</button>

<hr>
<h3>Admin Panel</h3>
<div id="users"></div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
emailjs.init("YOUR_EMAILJS_PUBLIC_KEY");

const firebaseConfig={
apiKey:"AIzaSyDctzYKpvGNfyF-P7wTNy_XcbN5ECP5vJc",
authDomain:"anfaguvenlik-17ad3.firebaseapp.com",
databaseURL:"https://anfaguvenlik-17ad3-default-rtdb.firebaseio.com",
projectId:"anfaguvenlik-17ad3"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.database();
const admin="yasindemirkan83@gmail.com";

let rumuz="",selected=null;

setInterval(()=>clock.innerText=new Date().toLocaleString("tr-TR"),1000);

function login(){
const p=new firebase.auth.GoogleAuthProvider();
auth.signInWithPopup(p).then(r=>{
const mail=r.user.email;
db.ref("ban/"+mail.replace(".","_")).once("value",b=>{
if(b.exists()){alert("Engellendiniz");return;}
rumuz=prompt("Rumuz:");
localStorage.mail=mail;
login.style.display="none";
app.style.display="block";
init();
});
});
}

function toggleNew(){
if(localStorage.mail!==admin)return;
newTask.style.display=newTask.style.display=="none"?"block":"none";
}

function addTask(){
const key=db.ref("tasks").push().key;
db.ref("tasks/"+key).set({
baslik:baslik.value,
aciklama:aciklama.value,
alarm:alarm.value,
yapildi:false,
ekleyen:rumuz
});
scheduleAlarm(alarm.value,baslik.value);
}

function scheduleAlarm(time,title){
if(Notification.permission!=="granted"){
Notification.requestPermission();
}
const diff=new Date(time)-new Date();
setTimeout(()=>{
new Notification("ANFA G√ñREV",{body:title});
},diff);
}

function init(){
db.ref("tasks").on("value",s=>{
gorevListe.innerHTML="";
s.forEach(t=>{
const d=document.createElement("div");
d.className="task";
if(t.val().yapildi)d.classList.add("yapildi");
d.innerHTML="<b>"+t.val().baslik+"</b><br>"+t.val().aciklama;
d.onclick=()=>{selected=t.key;}
gorevListe.prepend(d);
});
});

db.ref("messages").on("value",s=>{
mesajListe.innerHTML="";
s.forEach(m=>{
let d=document.createElement("div");
d.className="task";
d.innerHTML="<b>"+m.val().rumuz+"</b>: "+m.val().msg;
if(localStorage.mail==admin){
d.innerHTML+=" <button onclick='delMsg(\""+m.key+"\")'>üóëÔ∏è</button>";
}
mesajListe.append(d);
});
});

if(localStorage.mail==admin){
db.ref("online").on("value",s=>{
users.innerHTML="";
s.forEach(u=>{
users.innerHTML+=u.val()+" <button onclick='ban(\""+u.key+"\")'>BAN</button><br>";
});
});
}
}

function sendMsg(){
db.ref("messages").push({rumuz, msg:msg.value});
msg.value="";
}

function delMsg(k){db.ref("messages/"+k).remove();}
function deleteTask(){if(localStorage.mail==admin)db.ref("tasks/"+selected).remove();}
function doneTask(){if(localStorage.mail==admin)db.ref("tasks/"+selected+"/yapildi").set(true);}

function ban(mail){
db.ref("ban/"+mail).set(true);
alert("Banlandƒ±");
}

function sendFeedback(){
db.ref("feedback").push({rumuz, msg:fb.value});
emailjs.send("service_id","template_id",{
message:fb.value,
to_email:"yasindemirkan83@gmail.com"
});
alert("Mail g√∂nderildi");
fb.value="";
}
</script>

<script>
if("serviceWorker"in navigator){
navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
