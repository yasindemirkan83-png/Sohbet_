<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANFA G√ºvenlik</title>
<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
--bg-primary:#0f172a;
--bg-secondary:#1e293b;
--bg-tertiary:#334155;
--color-primary:#38bdf8;
--color-success:#10b981;
--color-warning:#fbbf24;
--color-text:#e2e8f0;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',system-ui,sans-serif}
body{background:url('https://images.unsplash.com/photo-1504384308090-c894fdcc538d?auto=format&fit=crop&w=1500&q=80') no-repeat center center fixed;background-size:cover;color:var(--color-text);min-height:100vh;padding:15px;max-width:500px;margin:auto}

/* HEADER */
header{background:rgba(0,0,0,0.8);padding:15px;display:flex;justify-content:space-between;align-items:center;font-size:20px;border-radius:12px;margin-bottom:15px}
header b{color:var(--color-primary)}
#clock{margin-right:10px}

/* CARD */
.card{background:rgba(255,255,255,0.95);padding:15px;margin-bottom:15px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.4)}
.task{border:1px solid #ccc;padding:10px;margin:5px 0;border-radius:8px;cursor:pointer}
.task.done{background:#d4edda;text-decoration:line-through}

/* BUTTONS */
button{padding:8px;border:none;border-radius:6px;background:#2196F3;color:white;cursor:pointer;margin:3px 0}
button:hover{background:#1976D2}

/* SETTINGS */
#settings{position:absolute;top:60px;right:15px;background:white;width:300px;padding:10px;border-radius:10px;display:none;z-index:999}
#adminPanel{margin-bottom:8px}
textarea{width:100%;border-radius:8px;padding:5px}

/* TAKVƒ∞M */
.toggle-btn{width:100%;background:#334155;border:none;border-radius:12px;padding:10px;color:#38bdf8;font-weight:700;margin-bottom:10px}
.vardiya-buttons{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:10px}
.vardiya-btn{background:var(--bg-primary);border:2px solid var(--bg-tertiary);border-radius:12px;padding:10px;color:white;cursor:pointer}
.vardiya-btn.active{border-color:var(--color-success)}
.weekdays{display:grid;grid-template-columns:repeat(7,1fr);font-size:.7rem;text-align:center;margin-bottom:5px;color:#94a3b8}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;max-height:200px;overflow-y:auto}
.day{background:var(--bg-tertiary);border-radius:8px;padding:6px;font-size:.8rem;text-align:center}
.work-day{background:rgba(16,185,129,.4)}
.work-night{background:rgba(56,189,248,.4)}
.off{background:rgba(100,116,139,.4)}
.today{outline:2px solid #38bdf8}
.summary{display:flex;justify-content:space-between;margin-top:10px}
.summary-value{font-size:1.2rem;font-weight:700}
</style>
</head>

<body>

<header>
<div><b>ANFA G√úVENLƒ∞K</b></div>
<div><span id="clock"></span><span style="cursor:pointer" onclick="toggleSettings()">‚öôÔ∏è</span></div>
</header>

<div id="settings">
<h3>Ayarlar</h3>
<div id="adminPanel"></div>
<hr>
<h4>G√∂r√º≈ü & √ñneri</h4>
<textarea id="feedback" placeholder="G√∂r√º≈ü ve √∂nerileriniz..."></textarea>
<button onclick="sendFeedback()">G√∂nder</button>
</div>

<div class="card" id="loginCard">
<button onclick="login()">Gmail ile Giri≈ü</button>
</div>

<div class="card" id="taskPanel" style="display:none">
<h3>G√∂rev Panosu</h3>
<div id="taskList" style="max-height:200px;overflow-y:auto"></div>
<div id="adminTask" style="display:none">
<hr>
<input id="title" placeholder="G√∂rev Ba≈ülƒ±ƒüƒ±">
<input type="datetime-local" id="start">
<input type="datetime-local" id="end">
<button onclick="addTask()">G√∂rev Ekle</button>
<button onclick="deleteTask()">Sil</button>
<button onclick="markDone()">Tamamlandƒ±</button>
<button onclick="setAlarm()">Alarm</button>
</div>
</div>

<div class="card" id="messagePanel" style="display:none">
<h3>Mesajlar <span id="msgCount"></span></h3>
<div id="messages" style="max-height:200px;overflow-y:auto"></div>
<input id="msgText" placeholder="Mesaj">
<button onclick="sendMsg()">G√∂nder</button>
</div>

<!-- ALT: √áALI≈ûMA TAKVƒ∞Mƒ∞ -->
<div class="card">
<button class="toggle-btn" onclick="toggleTakvim()">üìÖ √áalƒ±≈üma Takvimi</button>
<div id="takvimPanel" style="display:none">
<div class="section-title">Vardiya Se√ßimi</div>
<div class="vardiya-buttons">
<button class="vardiya-btn" data-v="1">1. Vardiya</button>
<button class="vardiya-btn" data-v="2">2. Vardiya</button>
<button class="vardiya-btn" data-v="3">3. Vardiya</button>
<button class="vardiya-btn" data-v="4">4. Vardiya</button>
</div>
<div style="display:flex;justify-content:space-between">
<button onclick="prevMonth()">‚óÄ</button>
<b id="monthTitle"></b>
<button onclick="nextMonth()">‚ñ∂</button>
</div>
<div class="weekdays">
<div>Pzt</div><div>Sal</div><div>√áar</div><div>Per</div><div>Cum</div><div>Cts</div><div>Paz</div>
</div>
<div class="calendar-grid" id="calendar"></div>
<div class="summary">
<div><div class="summary-value" id="dayCount">0</div>G√ºnd√ºz</div>
<div><div class="summary-value" id="nightCount">0</div>Gece</div>
<div><div class="summary-value" id="offCount">0</div>ƒ∞zin</div>
</div>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
apiKey: "AIzaSyDE5-fq9ifhtBlXTVOR1PhzD3XuVOWSVeE",
authDomain: "studio-3972799448-609d1.firebaseapp.com",
databaseURL: "https://studio-3972799448-609d1-default-rtdb.firebaseio.com",
projectId: "studio-3972799448-609d1",
storageBucket: "studio-3972799448-609d1.firebasestorage.app",
messagingSenderId: "210449601127",
appId: "1:210449601127:web:b3339666a09822b40c7ac2"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();

let userEmail="",selectedTask=null,msgSet=new Set();
const ADMIN="yasindemirkan83@gmail.com";

/* Saat */
function clock(){document.getElementById("clock").innerText=new Date().toLocaleString("tr-TR")}
setInterval(clock,1000);clock();

/* Ayarlar */
function toggleSettings(){let s=document.getElementById("settings");s.style.display=s.style.display=="block"?"none":"block"}
function sendFeedback(){
let f=document.getElementById("feedback").value;
if(!f)return alert("Bo≈ü mesaj g√∂nderilemez");
db.ref("feedback").push({user:userEmail,msg:f});
alert("G√∂nderildi");document.getElementById("feedback").value="";
}

/* Login */
function login(){
let provider=new firebase.auth.GoogleAuthProvider();
auth.signInWithPopup(provider).then(res=>{
userEmail=res.user.email;
document.getElementById("loginCard").style.display="none";
document.getElementById("taskPanel").style.display="block";
document.getElementById("messagePanel").style.display="block";
if(userEmail==ADMIN){document.getElementById("adminTask").style.display="block";document.getElementById("adminPanel").innerHTML="<b>ADMIN</b>";}
loadTasks();loadMessages();
});
}

/* G√∂rev */
function addTask(){
let title=document.getElementById("title").value.toUpperCase();
let start=document.getElementById("start").value;
let end=document.getElementById("end").value;
if(!title||!start)return alert("Ba≈ülƒ±k ve ba≈ülangƒ±√ß gerekli");
db.ref("tasks").orderByChild("title").equalTo(title).once("value",snap=>{
if(snap.exists()){alert("Bu g√∂rev zaten ekli");return;}
db.ref("tasks").push({title,start,end,done:false});
document.getElementById("title").value="";
});
}

function loadTasks(){
db.ref("tasks").on("value",snap=>{
let html="";selectedTask=null;
snap.forEach(s=>{
let t=s.val();
html+=`<div class="task ${t.done?"done":""}" onclick="selectTask('${s.key}')"><b>${t.title}</b><br>${t.start} - ${t.end}</div>`;
});
document.getElementById("taskList").innerHTML=html;
});
}

function selectTask(key){selectedTask=key}
function deleteTask(){if(userEmail!=ADMIN||!selectedTask)return;db.ref("tasks/"+selectedTask).remove()}
function markDone(){if(userEmail!=ADMIN||!selectedTask)return;db.ref("tasks/"+selectedTask+"/done").set(true)}
function setAlarm(){if(Notification.permission!=="granted")Notification.requestPermission();alert("Alarm ayarlandƒ± (tarayƒ±cƒ± a√ßƒ±kken √ßalƒ±≈üƒ±r)")}

/* Mesaj */
function sendMsg(){
let text=document.getElementById("msgText").value;
if(!text)return;
if(msgSet.has(text))return alert("Bu mesaj zaten g√∂nderildi");
db.ref("messages").push({user:userEmail,msg:text});
msgSet.add(text);
document.getElementById("msgText").value="";
}
function loadMessages(){
db.ref("messages").on("value",snap=>{
let html="";let count=0;
snap.forEach(s=>{
let m=s.val();
if(!msgSet.has(m.msg)){count++;}
html+=`<div>${m.user}: ${m.msg} ${userEmail==ADMIN?`<button onclick="delMsg('${s.key}')">Sil</button>`:""}</div>`;
});
document.getElementById("messages").innerHTML=html;
document.getElementById("msgCount").innerText=count>0?`(${count})`:"";
if(count>0)new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg").play();
});
}
function delMsg(k){db.ref("messages/"+k).remove()}

/* √áalƒ±≈üma Takvimi */
const BASLANGIC=new Date(Date.UTC(2026,0,1));
let secilen=localStorage.getItem("vardiya")||1;
let currentYear=new Date().getFullYear();
let currentMonth=new Date().getMonth();

document.querySelectorAll('.vardiya-btn').forEach(b=>{
if(b.dataset.v==secilen) b.classList.add("active")
b.onclick=()=>{
document.querySelectorAll('.vardiya-btn').forEach(x=>x.classList.remove('active'));
b.classList.add('active');
secilen=b.dataset.v;
localStorage.setItem("vardiya",secilen);
draw();
}
});

function vardiya(t){
const gunFarki=Math.floor((Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())-Date.UTC(2026,0,1))/86400000)%4;
const duzen=[['gece','izin','izin','gunduz'],['izin','izin','gunduz','gece'],['izin','gunduz','gece','izin'],['gunduz','gece','izin','izin']];
return duzen[(gunFarki+4)%4];
}

function draw(){
calendar.innerHTML='';let g=0,n=0,o=0;
const today=new Date();
const firstDay=(new Date(currentYear,currentMonth,1).getDay()+6)%7;
const days=new Date(currentYear,currentMonth+1,0).getDate();
monthTitle.innerText=new Date(currentYear,currentMonth).toLocaleDateString('tr-TR',{month:'long',year:'numeric'});
for(let i=0;i<firstDay;i++){calendar.appendChild(document.createElement('div'))}
for(let i=1;i<=days;i++){
const date=new Date(currentYear,currentMonth,i);
const v=vardiya(date)[secilen-1];
const d=document.createElement('div');
d.className='day '+(v==='gunduz'?'work-day':v==='gece'?'work-night':'off');
if(date.toDateString()===today.toDateString()) d.classList.add('today');
d.innerText=i;calendar.appendChild(d);
v==='gunduz'?g++:v==='gece'?n++:o++;
}
dayCount.innerText=g;nightCount.innerText=n;offCount.innerText=o;
}

function nextMonth(){currentMonth++;if(currentMonth>11){currentMonth=0;currentYear++}draw()}
function prevMonth(){currentMonth--;if(currentMonth<0){currentMonth=11;currentYear--}draw()}

draw();
loadTasks();
loadMessages();
</script>

<script>
if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js');}
</script>

</body>
</html>
