<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANFA GÃ¼venlik</title>
<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root{
--bg-primary:#ffffff;--bg-secondary:#f0f0f0;--bg-tertiary:#e0e0e0;
--color-primary:#38bdf8;--color-success:#10b981;--color-warning:#fbbf24;
--color-text:#000000;
}
body{margin:0;font-family:Arial,sans-serif;background:#ffffff;color:#000;min-height:100vh;padding:15px;max-width:500px;margin:auto;}
.header{background:linear-gradient(135deg,var(--bg-secondary),var(--bg-tertiary));padding:40px;border-radius:25px;text-align:center;margin-bottom:15px}
.logo-container{display:flex;justify-content:center;gap:12px;margin-bottom:10px}
.logo-icon{font-size:2.8rem;color:var(--color-primary)}
.logo-text{font-size:2.8rem;font-weight:800;color:var(--color-primary)}
#time{font-size:2.2rem;color:var(--color-primary)}
#date{font-size:.9rem;margin-top:5px}
.card{background:#fff;padding:15px;margin-bottom:15px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.2);color:#000;font-size:0.95rem;text-transform:uppercase;}
button{padding:8px 12px;border:none;border-radius:6px;background:#2196F3;color:white;cursor:pointer;margin:2px;font-weight:700;text-transform:uppercase;}
button:hover{background:#1976D2}
#settingsBtn{position:absolute;top:20px;right:20px;font-size:1.6rem;cursor:pointer;display:none}
#taskPanel,#messagePanel,#greetingCard{display:none;}
#taskList,#messages{max-height:250px;overflow-y:auto;border:1px solid #ccc;padding:5px;border-radius:8px;background:#fff;color:#000;font-size:0.95rem;}
.task,.msg{padding:8px;margin:5px 0;border-radius:8px;cursor:pointer;background:#f5f5f5;color:#000;text-transform:uppercase;}
.task.done{background:#d4edda;text-decoration:line-through;}
.task.selected,.msg.selected{outline:2px solid #38bdf8;}
.msg-controls{display:flex;gap:5px;margin-top:3px;}
.msg-controls button{flex:1;padding:5px;font-size:0.8rem;}
input[type=file]{display:none;}
img.msg-img{max-width:100%;border-radius:8px;cursor:pointer;}
</style>
</head>
<body>

<div class="header">
  <div class="logo-container">
    <div class="logo-icon"><i class="fas fa-shield-alt"></i></div>
    <div class="logo-text">ANFA GÃœVENLÄ°K</div>
  </div>
  <div id="date"></div>
  <div id="time"></div>
</div>

<!-- SETTINGS ICON -->
<span id="settingsBtn" onclick="toggleSettings()"><i class="fas fa-cog"></i></span>

<!-- LOGIN -->
<div class="card" id="loginCard">
  <button onclick="login()">GMAIL Ä°LE GÄ°RÄ°Åž</button>
</div>

<!-- GREETING -->
<div class="card" id="greetingCard"></div>

<!-- TASK PANEL -->
<div class="card" id="taskPanel">
  <h3>GÃ¶rev Panosu</h3>
  <div id="taskList"></div>
  <div id="adminTask" style="display:none;margin-top:5px;">
    <input id="title" placeholder="GÃ¶rev">
    <input type="datetime-local" id="start">
    <input type="datetime-local" id="end">
    <div style="display:flex;gap:5px;margin-top:5px;">
      <button onclick="addTask()"><i class="fas fa-plus"></i> EKLE</button>
      <button onclick="deleteTask()"><i class="fas fa-trash"></i> SÄ°L</button>
      <button onclick="markDone()"><i class="fas fa-check"></i> TAMAMLANDI</button>
      <button onclick="setAlarm()"><i class="fas fa-bell"></i> ALARM</button>
    </div>
  </div>
</div>

<!-- MESSAGE PANEL -->
<div class="card" id="messagePanel">
  <h3>Mesajlar</h3>
  <div id="messages"></div>
  <input id="msgText" placeholder="Mesaj">
  <input type="file" id="msgFile" onchange="sendMsgFile(event)">
  <button onclick="document.getElementById('msgFile').click()">FOTO EKLE</button>
  <button onclick="sendMsg()">GÃ–NDER</button>
</div>

<!-- SETTINGS PANEL -->
<div id="settings" class="card" style="display:none;position:absolute;top:70px;right:15px;width:300px;">
  <h3>Ayarlar <span style="float:right;cursor:pointer" onclick="toggleSettings()">ðŸ”™</span></h3>
  <div id="adminPanel"></div>
  <hr>
  <div>
    <h4>GÃ¶rÃ¼ÅŸ & Ã–nerileriniz</h4>
    <textarea id="feedback" style="width:100%"></textarea>
    <button onclick="sendFeedback()">GÃ–NDER</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// CONFIG
const firebaseConfig={apiKey:"AIzaSyDE5-fq9ifhtBlXTVOR1PhzD3XuVOWSVeE",authDomain:"studio-3972799448-609d1.firebaseapp.com",databaseURL:"https://studio-3972799448-609d1-default-rtdb.firebaseio.com",projectId:"studio-3972799448-609d1",storageBucket:"studio-3972799448-609d1.firebasestorage.app",messagingSenderId:"210449601127",appId:"1:210449601127:web:b3339666a09822b40c7ac2"};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(),db=firebase.database();
const ADMIN="yasindemirkan83@gmail.com";
let userEmail="",userName="",selectedTask=null,selectedMsg=null;

// CLOCK
function tick(){const n=new Date();document.getElementById("time").innerText=n.toLocaleTimeString("tr-TR");document.getElementById("date").innerText=n.toLocaleDateString("tr-TR",{weekday:'long',day:'numeric',month:'long',year:'numeric'});}
setInterval(tick,1000);tick();

// SETTINGS
function toggleSettings(){const s=document.getElementById("settings");s.style.display=s.style.display==="block"?"none":"block";}

// LOGIN
function login(){
  let provider=new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider).then(res=>{
    userEmail=res.user.email;
    userName=localStorage.getItem("userName")||res.user.email.split("@")[0].toUpperCase();
    localStorage.setItem("userName",userName);
    document.getElementById("loginCard").style.display="none";
    document.getElementById("greetingCard").style.display="block";
    document.getElementById("taskPanel").style.display="block";
    document.getElementById("messagePanel").style.display="block";
    document.getElementById("settingsBtn").style.display="inline-block";
    showGreeting();
    if(userEmail===ADMIN){document.getElementById("adminPanel").innerHTML="ADMIN PANELÄ°";}
    loadTasks();
    loadMessages();
  }).catch(e=>alert(e.message));
}

// GREETING
function showGreeting(){document.getElementById("greetingCard").innerText=`HOÅžGELDÄ°N ${userName}`;}

// TASKS
function addTask(){const t=document.getElementById("title").value.toUpperCase();const s=document.getElementById("start").value;const e=document.getElementById("end").value;if(!t) return;db.ref("tasks").push({title:t,start:s,end:e,done:false,user:userName});}
function loadTasks(){db.ref("tasks").on("value",snap=>{let html="";snap.forEach(s=>{let t=s.val();html+=`<div class="task ${t.done?"done":""}" onclick="selectTask('${s.key}',this)"><b>${t.user}</b>: ${t.title}<br>${t.start} - ${t.end}</div>`;});document.getElementById("taskList").innerHTML=html;});}
function selectTask(k,el){selectedTask=k;document.querySelectorAll(".task").forEach(x=>x.classList.remove("selected"));el.classList.add("selected");}
function deleteTask(){if(!selectedTask) return;db.ref("tasks/"+selectedTask).remove();}
function markDone(){if(!selectedTask) return;db.ref("tasks/"+selectedTask+"/done").set(true);}
function setAlarm(){if(Notification.permission!=="granted") Notification.requestPermission(); alert("Alarm ayarlandÄ± (BaÅŸlangÄ±Ã§ zamanÄ± alarm)");}

// MESSAGES
function loadMessages(){db.ref("messages").on("value",snap=>{let html="";snap.forEach(s=>{let m=s.val();let uname=m.user.split("@")[0].toUpperCase();html+=`<div class="msg" onclick="selectMsg('${s.key}',this)"><b>${uname}</b>: ${m.msg.toUpperCase()}`+(m.img?`<br><img src="${m.img}" class="msg-img" onclick="window.open('${m.img}')">`:"")+`${userEmail===ADMIN||m.user===userEmail?`<div class="msg-controls"><button onclick="delMsg('${s.key}')">SÄ°L</button></div>`:""} </div>`;});document.getElementById("messages").innerHTML=html;});}
function sendMsg(){let t=document.getElementById("msgText").value.toUpperCase();if(!t) return;db.ref("messages").push({user:userEmail,msg:t});document.getElementById("msgText").value="";}
function sendMsgFile(e){const file=e.target.files[0];if(!file) return;const reader=new FileReader();reader.onload=function(evt){db.ref("messages").push({user:userEmail,msg:"",img:evt.target.result});};reader.readAsDataURL(file);}
function delMsg(k){db.ref("messages/"+k).remove();}
function selectMsg(k,el){selectedMsg=k;document.querySelectorAll(".msg").forEach(x=>x.classList.remove("selected"));el.classList.add("selected");}

// FEEDBACK
function sendFeedback(){let f=document.getElementById("feedback").value.toUpperCase();if(!f) return;db.ref("feedback").push({user:userName,msg:f});alert("GÃ¶nderildi");document.getElementById("feedback").value="";}

// PWA
if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js');}
</script>
</body>
</html>
