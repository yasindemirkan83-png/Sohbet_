<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>ANFA GÃ¼venlik</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">

<style>
body{
  margin:0;
  font-family:Arial;
  background:url("https://picsum.photos/1080/1920") no-repeat center center fixed;
  background-size:cover;
  color:white;
}
header{
  background:rgba(0,0,0,0.7);
  padding:10px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}
.card{
  background:rgba(0,0,0,0.7);
  margin:10px;
  padding:10px;
  border-radius:10px;
}
button,input,textarea{
  width:100%;
  margin-top:5px;
  padding:8px;
  border-radius:6px;
  border:none;
}
.list{
  max-height:200px;
  overflow-y:auto;
}
.task.done{
  text-decoration:line-through;
  color:lightgreen;
}
.hide{display:none}
</style>
</head>

<body>

<header>
ANFA GÃœVENLÄ°K  
<div id="userInfo"></div>
</header>

<div class="card" id="loginCard">
<button onclick="login()">Google ile GiriÅŸ</button>
</div>

<!-- MESAJLAR -->
<div class="card hide" id="messageCard">
<h3 onclick="toggleMsg()">ðŸ“© Mesajlar (<span id="msgCount">0</span>)</h3>
<div id="msgArea" class="hide">
<textarea id="msgText" placeholder="Mesaj yaz"></textarea>
<button onclick="sendMessage()">GÃ¶nder</button>
<div class="list" id="msgList"></div>
</div>
</div>

<!-- GÃ–REVLER -->
<div class="card hide" id="taskCard">
<h3>ðŸ“‹ GÃ¶revler</h3>
<input id="taskTitle" placeholder="GÃ¶rev">
<input type="datetime-local" id="taskStart">
<input type="datetime-local" id="taskEnd">
<button onclick="addTask()">Ekle</button>
<div class="list" id="taskList"></div>
</div>

<!-- TAKVÄ°M -->
<div class="card hide" id="calendarCard">
<h3>ðŸ“… Ã‡alÄ±ÅŸma Takvimi</h3>
<input type="date" id="calDate">
<input id="calNote" placeholder="Not">
<button onclick="addCalendar()">Ekle</button>
<div class="list" id="calList"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
 apiKey: "API_KEY",
 authDomain: "PROJECT.firebaseapp.com",
 databaseURL: "https://PROJECT.firebaseio.com",
 projectId: "PROJECT",
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

let currentUser = null;
const ADMIN = "yasindemirkan83@gmail.com";

/* GÄ°RÄ°Åž */
function login(){
 const provider = new firebase.auth.GoogleAuthProvider();
 auth.signInWithPopup(provider);
}

auth.onAuthStateChanged(user=>{
 if(user){
   currentUser=user;
   document.getElementById("loginCard").classList.add("hide");
   document.getElementById("messageCard").classList.remove("hide");
   document.getElementById("taskCard").classList.remove("hide");
   document.getElementById("calendarCard").classList.remove("hide");
   document.getElementById("userInfo").innerText=user.email;
   loadMessages();
   loadTasks();
   loadCalendar();
   Notification.requestPermission();
 }
});

/* MESAJ */
function toggleMsg(){
 document.getElementById("msgArea").classList.toggle("hide");
}

function sendMessage(){
 let text = msgText.value.trim();
 if(!text) return;
 let id = Date.now();
 db.ref("messages/"+id).set({
   user:currentUser.email,
   text:text
 });
 msgText.value="";
}

function loadMessages(){
 db.ref("messages").on("value",snap=>{
   let html="";
   let count=0;
   snap.forEach(s=>{
     let d=s.val();
     count++;
     html+=`<div>
     <b>${d.user}</b>: ${d.text}
     ${currentUser.email==ADMIN?`<button onclick="delMsg('${s.key}')">Sil</button>`:""}
     </div>`;
   });
   msgList.innerHTML=html;
   msgCount.innerText=count;
   if(count>0){
     new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg").play();
   }
 });
}

function delMsg(id){
 db.ref("messages/"+id).remove();
}

/* GÃ–REV */
function addTask(){
 let t=taskTitle.value.trim().toUpperCase();
 if(!t) return;
 let id=Date.now();
 db.ref("tasks/"+id).set({
   title:t,
   start:taskStart.value,
   end:taskEnd.value,
   done:false
 });
 taskTitle.value="";
}

function loadTasks(){
 db.ref("tasks").on("value",snap=>{
   let html="";
   snap.forEach(s=>{
     let d=s.val();
     html+=`<div class="task ${d.done?"done":""}">
     ${d.title}
     <button onclick="markTask('${s.key}')">âœ”</button>
     ${currentUser.email==ADMIN?`<button onclick="delTask('${s.key}')">Sil</button>`:""}
     </div>`;
   });
   taskList.innerHTML=html;
 });
}

function markTask(id){
 db.ref("tasks/"+id+"/done").set(true);
}

function delTask(id){
 db.ref("tasks/"+id).remove();
}

/* TAKVÄ°M */
function addCalendar(){
 let note=calNote.value;
 let date=calDate.value;
 let id=Date.now();
 db.ref("calendar/"+id).set({date,note});
 calNote.value="";
}

function loadCalendar(){
 db.ref("calendar").on("value",snap=>{
   let html="";
   snap.forEach(s=>{
     let d=s.val();
     html+=`<div>${d.date} - ${d.note}</div>`;
   });
   calList.innerHTML=html;
 });
}
</script>
</body>
</html>
