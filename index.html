<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANFA Güvenlik</title>
<link rel="manifest" href="manifest.json">

<style>
body{
margin:0;
font-family:Arial;
background:url('https://images.unsplash.com/photo-1504384308090-c894fdcc538d?auto=format&fit=crop&w=1500&q=80') no-repeat center center fixed;
background-size:cover;
}

header{
background:rgba(0,0,0,0.8);
color:white;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
font-size:20px;
}

#panel{padding:15px}
.card{
background:rgba(255,255,255,0.95);
padding:15px;
margin-bottom:15px;
border-radius:12px;
box-shadow:0 4px 10px rgba(0,0,0,0.4)
}

.task{
border:1px solid #ccc;
padding:10px;
margin:5px 0;
border-radius:8px;
cursor:pointer;
}

.task.done{
background:#d4edda;
text-decoration:line-through;
}

button{
padding:8px;
border:none;
border-radius:6px;
background:#2196F3;
color:white;
cursor:pointer;
}

button:hover{background:#1976D2}

#settings{
position:absolute;
top:60px;
right:15px;
background:white;
width:300px;
padding:10px;
border-radius:10px;
display:none;
z-index:999;
}
</style>
</head>

<body>

<header>
<div><b>ANFA GÜVENLİK</b></div>
<div>
<span id="clock"></span>
<span style="margin-left:10px;cursor:pointer" onclick="toggleSettings()">⚙️</span>
</div>
</header>

<div id="settings">
<h3>Ayarlar</h3>
<div id="adminPanel"></div>
<hr>
<h4>Görüş & Öneri</h4>
<textarea id="feedback" style="width:100%"></textarea>
<button onclick="sendFeedback()">Gönder</button>
</div>

<div id="panel">

<div class="card" id="loginCard">
<button onclick="login()">Gmail ile Giriş</button>
</div>

<div class="card" id="taskPanel" style="display:none">
<h3>Görev Panosu</h3>
<div id="taskList"></div>

<div id="adminTask" style="display:none">
<hr>
<input id="title" placeholder="Görev">
<input type="datetime-local" id="start">
<input type="datetime-local" id="end">
<button onclick="addTask()">Görev Ekle</button>
<button onclick="deleteTask()">Sil</button>
<button onclick="markDone()">Tamamlandı</button>
<button onclick="setAlarm()">Alarm</button>
</div>
</div>

<div class="card" id="messagePanel" style="display:none">
<h3>Mesajlar</h3>
<div id="messages"></div>
<input id="msgText" placeholder="Mesaj">
<button onclick="sendMsg()">Gönder</button>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
apiKey: "AIzaSyDctzYKpvGNfyF-P7wTNy_XcbN5ECP5vJc",
authDomain: "anfaguvenlik-17ad3.firebaseapp.com",
databaseURL: "https://anfaguvenlik-17ad3-default-rtdb.firebaseio.com",
projectId: "anfaguvenlik-17ad3"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();

let userEmail="";
let selectedTask=null;
const ADMIN="yasindemirkan83@gmail.com";

function clock(){
document.getElementById("clock").innerText=new Date().toLocaleString("tr-TR");
}
setInterval(clock,1000);

function toggleSettings(){
let s=document.getElementById("settings");
s.style.display=s.style.display=="block"?"none":"block";
}

function login(){
let provider=new firebase.auth.GoogleAuthProvider();
auth.signInWithPopup(provider).then(res=>{
userEmail=res.user.email;
document.getElementById("loginCard").style.display="none";
document.getElementById("taskPanel").style.display="block";
document.getElementById("messagePanel").style.display="block";
if(userEmail==ADMIN){
document.getElementById("adminTask").style.display="block";
document.getElementById("adminPanel").innerHTML="<b>ADMIN</b>";
}
loadTasks();
loadMessages();
});
}

function addTask(){
let title=document.getElementById("title").value.toUpperCase();
let start=document.getElementById("start").value;
let end=document.getElementById("end").value;
db.ref("tasks").push({title,start,end,done:false});
}

function loadTasks(){
db.ref("tasks").on("value",snap=>{
let html="";
snap.forEach(s=>{
let t=s.val();
html+=`<div class="task ${t.done?"done":""}" onclick="selectTask('${s.key}')">
<b>${t.title}</b><br>${t.start} - ${t.end}
</div>`;
});
document.getElementById("taskList").innerHTML=html;
});
}

function selectTask(key){selectedTask=key}

function deleteTask(){
if(userEmail!=ADMIN||!selectedTask)return;
db.ref("tasks/"+selectedTask).remove();
}

function markDone(){
if(userEmail!=ADMIN||!selectedTask)return;
db.ref("tasks/"+selectedTask+"/done").set(true);
}

function setAlarm(){
if(Notification.permission!=="granted")Notification.requestPermission();
alert("Alarm ayarlandı (tarayıcı açıkken çalışır)");
}

function sendMsg(){
let text=document.getElementById("msgText").value;
db.ref("messages").push({user:userEmail,msg:text});
}

function loadMessages(){
db.ref("messages").on("value",snap=>{
let html="";
snap.forEach(s=>{
let m=s.val();
html+=`<div>${m.user}: ${m.msg} ${userEmail==ADMIN?`<button onclick="delMsg('${s.key}')">Sil</button>`:""}</div>`;
});
document.getElementById("messages").innerHTML=html;
});
}

function delMsg(k){
db.ref("messages/"+k).remove();
}

function sendFeedback(){
let f=document.getElementById("feedback").value;
db.ref("feedback").push({user:userEmail,msg:f});
alert("Gönderildi");
}
</script>

<script>
if('serviceWorker' in navigator){
navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>
