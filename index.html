<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Görev & Mesaj Sistemi</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#eceff1;margin:0}
header{background:#263238;color:#fff;padding:15px;text-align:center;font-size:20px}
.card{background:#fff;margin:15px;padding:15px;border-radius:10px;box-shadow:0 3px 8px rgba(0,0,0,.2)}
input,button{width:100%;padding:8px;margin:6px 0;font-size:14px;border-radius:6px;border:1px solid #ccc}
button{background:#2196F3;color:#fff;border:none}
.task{border:1px solid #aaa;border-radius:6px;padding:8px;margin:5px 0}
.msg{background:#f5f5f5;padding:6px;border-radius:5px;margin:4px 0}
</style>
</head>
<body>

<header>Görev & Mesaj Sistemi</header>

<div class="card" id="login">
<h3>Giriş</h3>
<input id="gmail" placeholder="Gmail adresin">
<button id="loginBtn">Giriş Yap</button>
</div>

<div class="card" id="app" style="display:none">
<h3>Yeni Görev</h3>
<input id="baslik" placeholder="Başlık">
<input id="aciklama" placeholder="Açıklama">
<button id="gorevBtn">Görev Kaydet</button>

<hr>
<h3>Mesaj</h3>
<input id="mesajInput" placeholder="Mesaj yaz">
<button id="mesajBtn">Mesaj Gönder</button>

<hr>
<h3>Görevler</h3>
<div id="gorevListe"></div>

<hr>
<h3>Mesajlar</h3>
<div id="mesajListe"></div>
</div>

<script>
const API = "YOUR_DEPLOYED_SCRIPT_URL_HERE"; // Apps Script URL

const loginDiv = document.getElementById("login");
const appDiv = document.getElementById("app");
const loginBtn = document.getElementById("loginBtn");
const gorevBtn = document.getElementById("gorevBtn");
const mesajBtn = document.getElementById("mesajBtn");

const gmailInput = document.getElementById("gmail");
const baslikInput = document.getElementById("baslik");
const aciklamaInput = document.getElementById("aciklama");
const mesajInput = document.getElementById("mesajInput");

const gorevListe = document.getElementById("gorevListe");
const mesajListe = document.getElementById("mesajListe");

let rumuz = "";

loginBtn.addEventListener("click", () => {
  const email = gmailInput.value.trim();
  if (!email || !email.includes("@")) { alert("Geçerli Gmail gir"); return; }
  rumuz = email.split("@")[0];
  localStorage.setItem("rumuz", rumuz);
  loginDiv.style.display = "none";
  appDiv.style.display = "block";
  veriGetir();
  setInterval(veriGetir, 5000);
});

gorevBtn.addEventListener("click", () => {
  const baslik = baslikInput.value.trim();
  const aciklama = aciklamaInput.value.trim();
  if (!baslik) { alert("Başlık boş"); return; }
  const now = new Date();
  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      tip: "not",
      tarihSaat: now.toLocaleDateString(),
      saat: now.toLocaleTimeString(),
      baslik: baslik,
      aciklama: aciklama,
      kullanici: rumuz
    })
  }).then(() => { baslikInput.value=""; aciklamaInput.value=""; veriGetir(); })
    .catch(err => console.error(err));
});

mesajBtn.addEventListener("click", () => {
  const mesaj = mesajInput.value.trim();
  if (!mesaj) { alert("Mesaj boş"); return; }
  const now = new Date();
  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      tip: "mesaj",
      tarih: now.toLocaleDateString(),
      saat: now.toLocaleTimeString(),
      mesaj: mesaj,
      kullanici: rumuz
    })
  }).then(() => { mesajInput.value=""; veriGetir(); })
    .catch(err => console.error(err));
});

function veriGetir() {
  fetch(API)
    .then(r => r.json())
    .then(d => {
      gorevListe.innerHTML = "";
      mesajListe.innerHTML = "";
      if(!d.veriler) return;

      d.veriler.forEach(r => {
        if(r[0] === "not"){
          const div = document.createElement("div");
          div.className = "task";
          div.innerHTML = `<b>${r[1]} ${r[2]}</b><br>${r[3]}<br>${r[4]}<br><small>${r[5]}</small>`;
          gorevListe.appendChild(div);
        } else if(r[0] === "mesaj"){
          const div = document.createElement("div");
          div.className = "msg";
          div.innerHTML = `<b>${r[5]}</b>: ${r[4]}`;
          mesajListe.appendChild(div);
        }
      });

      if(gorevListe.innerHTML==="") gorevListe.innerHTML="Görev yok";
      if(mesajListe.innerHTML==="") mesajListe.innerHTML="Mesaj yok";
    }).catch(err => console.error(err));
}
</script>
</body>
</html>
