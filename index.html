<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANFA G√ºvenlik</title>
<link rel="manifest" href="manifest.json">

<style>
body{
margin:0;
font-family:Arial;
background:url('https://images.unsplash.com/photo-1504384308090-c894fdcc538d?auto=format&fit=crop&w=1500&q=80') no-repeat center center fixed;
background-size:cover;
}

header{
background:rgba(0,0,0,0.8);
color:white;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
font-size:20px;
}

#panel{padding:15px}

.card{
background:rgba(255,255,255,0.95);
padding:15px;
margin-bottom:15px;
border-radius:12px;
box-shadow:0 4px 10px rgba(0,0,0,0.4)
}

.task{
border:1px solid #ccc;
padding:10px;
margin:5px 0;
border-radius:8px;
cursor:pointer;
}

.task.done{
background:#d4edda;
text-decoration:line-through;
}

button{
padding:8px;
border:none;
border-radius:6px;
background:#2196F3;
color:white;
cursor:pointer;
}

button:hover{background:#1976D2}

#settings{
position:absolute;
top:60px;
right:15px;
background:white;
width:300px;
padding:10px;
border-radius:10px;
display:none;
z-index:999;
}

.scrollBox{
max-height:250px;
overflow-y:auto;
border:1px solid #ccc;
padding:5px;
}
</style>
</head>

<body>

<header>
<div><b>ANFA G√úVENLƒ∞K</b></div>
<div>
<span id="clock"></span>
<span style="margin-left:10px;cursor:pointer" onclick="toggleSettings()">‚öôÔ∏è</span>
</div>
</header>

<div id="settings">
<h3>Ayarlar</h3>
<div id="adminPanel"></div>
<hr>
<h4>G√∂r√º≈ü & √ñneri</h4>
<textarea id="feedback" style="width:100%"></textarea>
<button onclick="sendFeedback()">G√∂nder</button>
</div>

<div id="panel">

<div class="card" id="loginCard">
<button onclick="login()">Gmail ile Giri≈ü</button>
</div>

<div class="card" id="taskPanel" style="display:none">
<h3>G√∂rev Panosu</h3>
<div id="taskList" class="scrollBox"></div>

<div id="adminTask" style="display:none">
<hr>
<input id="title" placeholder="G√∂rev">
<input type="datetime-local" id="start">
<input type="datetime-local" id="end">
<br><br>
<button onclick="addTask()">G√∂rev Ekle</button>
<button onclick="deleteTask()">Sil</button>
<button onclick="markDone()">Tamamlandƒ±</button>
</div>
</div>

<div class="card" id="messagePanel" style="display:none">
<h3 onclick="toggleMsg()" style="cursor:pointer">
Mesajlar <span id="msgCount"></span>
</h3>
<div id="messages" class="scrollBox" style="display:none"></div>
<input id="msgText" placeholder="Mesaj">
<button onclick="sendMsg()">G√∂nder</button>
</div>

<!-- TAKVƒ∞M -->
<div class="card">
<button onclick="toggleTakvim()">üìÖ √áALI≈ûMA TAKVƒ∞Mƒ∞</button>
<div id="takvimPanel" style="display:none">
<div id="calendar"></div>
</div>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
apiKey: "BURAYI_DEƒûƒ∞≈ûTƒ∞R",
authDomain: "BURAYI_DEƒûƒ∞≈ûTƒ∞R",
databaseURL: "BURAYI_DEƒûƒ∞≈ûTƒ∞R",
projectId: "BURAYI_DEƒûƒ∞≈ûTƒ∞R"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.database();

let userEmail="";
let selectedTask=null;
const ADMIN="yasindemirkan83@gmail.com";

function clock(){
document.getElementById("clock").innerText=new Date().toLocaleString("tr-TR");
}
setInterval(clock,1000);

function toggleSettings(){
settings.style.display=settings.style.display=="block"?"none":"block";
}

function login(){
let provider=new firebase.auth.GoogleAuthProvider();
auth.signInWithPopup(provider).catch(e=>alert(e.message));
}

auth.onAuthStateChanged(u=>{
if(!u) return;
userEmail=u.email;
loginCard.style.display="none";
taskPanel.style.display="block";
messagePanel.style.display="block";

if(userEmail==ADMIN){
adminTask.style.display="block";
adminPanel.innerHTML="<b>ADMIN AKTƒ∞F</b>";
}

loadTasks();
loadMessages();
});

function addTask(){
let title=document.getElementById("title").value.toUpperCase();
let start=document.getElementById("start").value;
let end=document.getElementById("end").value;
if(!title) return;
db.ref("tasks").push({title,start,end,done:false});
}

function loadTasks(){
db.ref("tasks").on("value",snap=>{
let html="";
snap.forEach(s=>{
let t=s.val();
html+=`<div class="task ${t.done?"done":""}" onclick="selectTask('${s.key}')">
<b>${t.title}</b><br>${t.start} - ${t.end}
</div>`;
});
taskList.innerHTML=html;
});
}

function selectTask(k){selectedTask=k}

function deleteTask(){
if(userEmail!=ADMIN||!selectedTask)return;
db.ref("tasks/"+selectedTask).remove();
}

function markDone(){
if(userEmail!=ADMIN||!selectedTask)return;
db.ref("tasks/"+selectedTask+"/done").set(true);
}

function sendMsg(){
let text=msgText.value;
if(!text) return;
db.ref("messages").push({user:userEmail,msg:text});
msgText.value="";
}

function loadMessages(){
db.ref("messages").on("value",snap=>{
let html="";
let c=0;
snap.forEach(s=>{
let m=s.val(); c++;
html+=`<div>${m.user}: ${m.msg}
${userEmail==ADMIN?`<button onclick="delMsg('${s.key}')">Sil</button>`:""}
</div>`;
});
messages.innerHTML=html;
msgCount.innerText="("+c+")";
});
}

function delMsg(k){
db.ref("messages/"+k).remove();
}

function toggleMsg(){
messages.style.display=messages.style.display=="block"?"none":"block";
}

function sendFeedback(){
let f=feedback.value;
db.ref("feedback").push({user:userEmail,msg:f});
alert("G√∂nderildi");
feedback.value="";
}

function toggleTakvim(){
takvimPanel.style.display=takvimPanel.style.display=="block"?"none":"block";
}
</script>

<script>
if('serviceWorker' in navigator){
navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>
