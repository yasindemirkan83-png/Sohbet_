<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANFA Güvenlik</title>
<link rel="manifest" href="manifest.json">
<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:url("https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&w=1600&q=80") no-repeat center center fixed;
  background-size:cover;
}
header{
  background:rgba(0,0,0,0.7);
  color:#fff;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#title{font-size:24px;font-weight:bold;color:#4FC3F7;}
.card{
  background:rgba(255,255,255,0.95);
  margin:15px;
  padding:15px;
  border-radius:12px;
  box-shadow:0 4px 10px rgba(0,0,0,0.3);
}
button{
  padding:10px;
  border:none;
  border-radius:6px;
  background:#2196F3;
  color:white;
  cursor:pointer;
}
button:disabled{background:#aaa;}
.task{
  border:1px solid #ccc;
  padding:10px;
  margin:5px 0;
  border-radius:8px;
}
.task.done{background:#c8e6c9;}
</style>
</head>
<body>

<header>
<div id="title">ANFA GÜVENLİK</div>
<div id="clock"></div>
</header>

<div class="card" id="loginCard">
<h3>Giriş</h3>
<button onclick="login()">Google ile Giriş</button>
</div>

<div id="app" style="display:none">

<div class="card">
<h3>Hoşgeldin <span id="userName"></span></h3>
</div>

<div class="card" id="taskPanel">
<h3>Görevler</h3>
<div id="taskList"></div>

<div id="adminTask" style="display:none">
<h4>Yeni Görev</h4>
<input id="tTitle" placeholder="Başlık"><br>
<input id="tDesc" placeholder="Açıklama"><br>
<button onclick="addTask()">Görev Ekle</button>
</div>
</div>

<div class="card">
<h3>Mesajlar</h3>
<div id="msgList"></div>
<input id="msgInput" placeholder="Mesaj yaz">
<button onclick="sendMsg()">Gönder</button>
</div>

<div class="card">
<h3>Görüş & Öneri</h3>
<textarea id="feedback" style="width:100%;height:60px;"></textarea>
<button onclick="sendFeedback()">Gönder</button>
</div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDctzYKpvGNfyF-P7wTNy_XcbN5ECP5vJc",
  authDomain: "anfaguvenlik-17ad3.firebaseapp.com",
  databaseURL: "https://anfaguvenlik-17ad3-default-rtdb.firebaseio.com/",
  projectId: "anfaguvenlik-17ad3"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.database();
const adminMail="yasindemirkan83@gmail.com";
let userEmail="";
let userName="";

function clock(){
  document.getElementById("clock").innerText=new Date().toLocaleString("tr-TR");
}
setInterval(clock,1000);clock();

function login(){
  const provider=new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider).then(r=>{
    userEmail=r.user.email;
    userName=r.user.displayName;
    document.getElementById("loginCard").style.display="none";
    document.getElementById("app").style.display="block";
    document.getElementById("userName").innerText=userName;
    if(userEmail===adminMail){
      document.getElementById("adminTask").style.display="block";
    }
    loadTasks();
    loadMsgs();
  }).catch(e=>alert(e.message));
}

function addTask(){
  const title=document.getElementById("tTitle").value;
  const desc=document.getElementById("tDesc").value;
  if(!title){alert("Başlık gerekli");return;}
  db.ref("tasks").push({title,desc,done:false});
  document.getElementById("tTitle").value="";
  document.getElementById("tDesc").value="";
}

function loadTasks(){
  db.ref("tasks").on("value",snap=>{
    const list=document.getElementById("taskList");
    list.innerHTML="";
    snap.forEach(s=>{
      const t=s.val();
      const div=document.createElement("div");
      div.className="task"+(t.done?" done":"");
      div.innerHTML=`<b>${t.title}</b><br>${t.desc}`;
      if(userEmail===adminMail){
        div.onclick=()=>db.ref("tasks/"+s.key).update({done:!t.done});
      }
      list.append(div);
    });
  });
}

function sendMsg(){
  const txt=document.getElementById("msgInput").value;
  if(!txt)return;
  db.ref("messages").push({
    user:userName,
    msg:txt,
    time:new Date().toLocaleString("tr-TR")
  });
  document.getElementById("msgInput").value="";
}

function loadMsgs(){
  db.ref("messages").on("value",snap=>{
    const list=document.getElementById("msgList");
    list.innerHTML="";
    snap.forEach(s=>{
      const m=s.val();
      const div=document.createElement("div");
      div.className="task";
      div.innerHTML=`<b>${m.user}</b>: ${m.msg}<br><small>${m.time}</small>`;
      list.append(div);
    });
  });
}

function sendFeedback(){
  const txt=document.getElementById("feedback").value;
  if(!txt)return;
  db.ref("feedback").push({
    user:userName,
    msg:txt,
    time:new Date().toLocaleString("tr-TR")
  });
  document.getElementById("feedback").value="";
  alert("Gönderildi");
}
</script>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
